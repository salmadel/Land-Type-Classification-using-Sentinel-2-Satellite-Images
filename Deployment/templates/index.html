<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLens</title>
    <style>
        /* Page background & text styling */
        body {
            background-color: #EDE2C7;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        /* Main container styling */
        .container {
            background-color: white;
            width: 80%;
            margin: 50px auto;
            padding: 40px;
            border-radius: 30px;
            position: relative;
        }

        /* Titles styling */
        h1 {
            color: #6B3F1D;
            font-size: 40px;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 20px;
            color: #6B3F1D;
            margin-bottom: 15px;
        }

        /* Text styling */
        p {
            color: #6B3F1D;
            font-size: 20px;
            margin: 100px;
            line-height: 1.5;
        }

        /* File upload section styling */
        .upload-section {
            margin-top: 100px;
        }

        .upload-btn {
            border: 2px solid #EDE2C7;
            color: #6B3F1D;
            background-color: white;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            display: inline-block;
        }

        .upload-btn:hover {
            background-color: #EDE2C7;
        }

        /* Hiding default file input button */
        #file-input {
            display: none;
        }

        /* Displaying image & prediction */
        .image-prediction-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 150px;
            margin-top: 40px;
        }

        /* Image preview styling */
        .image-preview {
            width: 200px;
            height: 200px;
            border-radius: 15px;
            border: 2px solid #C3B091;
            display: none;
            object-fit: cover;
        }

        /* Prediction text styling */
        .prediction {
            font-size: 20px;
            font-weight: bold;
            color: #6B3F1D;
            display: none;
            text-align: center;
            margin-top: -15px;
        }

        /* Prediction result styling */
        .prediction span {
            display: block;
            font-size: 26px;
            font-weight: bold;
            color: #5A3520;
            margin-bottom: 15px; 
            margin-top: 25px;    
        }

        .prediction p {
            font-size: 20px;
            color: #6B3F1D;
            margin: 0;
        }


        /* Chatbot widget styles */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px #7a4e2d;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .chatbot-header {
            background-color: #7A4E2D;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .chatbot-messages {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            font-weight: bold
        }

        .message {
            padding: 8px 12px;
            margin: 5px;
            border-radius: 15px;
            max-width: 70%;
            background-color: #EDE2C7;
            color: #5A3520;
        }

        .user-message {
            align-self: flex-end;
            text-align: right;
        }

        .bot-message {
            align-self: flex-start;
            text-align: left;
        }

        .chatbot-input {
            display: flex;
            border-top: 1px solid #ddd;
        }

        .chatbot-input input {
            flex: 1;
            padding: 10px;
            border: none;
            outline: none;
        }

        .chatbot-input button {
            padding: 10px;
            background-color: #7A4E2D;
            color: white;
            border: none;
            cursor: pointer;
        }

        .chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #7a4e2d;
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 4px 8px #7a4e2d;
        }
    </style>
</head>

<body>

    <!-- Main container -->
    <div class="container">

        <!-- Title & description-->
        <h1>GeoLens</h1>
        <h2>Smart Land Discovery with AI</h2>
        <p>GeoLens is an AI-powered platform that analyzes satellite images to classify land types with high accuracy.
            It transforms raw satellite data into actionable insights for agriculture, urban planning, and environmental
            monitoring, making geospatial analysis smarter and more accessible.</p>

        <!-- Image upload section -->
        <div class="upload-section">
            <label for="file-input" class="upload-btn">Upload an Image</label>
            <input type="file" id="file-input" accept="image/*">
        </div>

        <!-- Image prediction section -->
        <div class="image-prediction-container">
            <img id="preview" class="image-preview">
            <div class="prediction">
                <span>Prediction:</span>
                <p id="prediction-text">--</p>
                <span>Confidence:</span> 
                <p id="confidence-text">--</p>
            </div>
        </div>

        <!-- Chatbot widget -->
        <div class="chatbot-container" id="chatbot">
            <div class="chatbot-header">Chatbot</div>
            <div class="chatbot-messages" id="chatbot-messages"></div>
            <div class="chatbot-input">
                <input type="text" id="chatbot-input" placeholder="Type a message...">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>

        <button class="chatbot-toggle" onclick="toggleChatbot()">ðŸ’¬</button>

    </div>

    <script>
        // Toggle chatbot visibility
        function toggleChatbot() {
            var chatbot = document.getElementById("chatbot");
            var toggleButton = document.querySelector(".chatbot-toggle");

            if (chatbot.style.display === "none" || chatbot.style.display === "") {
                chatbot.style.display = "block";
                toggleButton.style.display = "none"; // Hide the button
            } else {
                chatbot.style.display = "none";
                toggleButton.style.display = "block"; // Show the button
            }
        }

        // Send message to chatbot and get response
        function sendMessage() {
            var inputField = document.getElementById("chatbot-input");
            var messageText = inputField.value.trim();
            if (messageText === "") return;

            var messagesContainer = document.getElementById("chatbot-messages");

            // Add user message
            var userMessage = document.createElement("div");
            userMessage.classList.add("message", "user-message");
            userMessage.innerText = messageText;
            messagesContainer.appendChild(userMessage);

            // Send request to backend
            fetch("/chatbot", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: messageText })
            })
            .then(response => response.json())
            .then(data => {
                var botMessage = document.createElement("div");
                botMessage.classList.add("message", "bot-message");
                botMessage.innerText = data.response;
                messagesContainer.appendChild(botMessage);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            })
            .catch(error => console.error("Error:", error));

            inputField.value = "";
        }

        // Image upload & model prediction
        document.getElementById('file-input').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();

                // Displaying image preview
                reader.onload = function (e) {
                    const img = document.getElementById('preview');
                    img.src = e.target.result;
                    img.style.display = 'block';

                    
                    // Updationg & showing prediction & confidence
                    const predictionText = document.getElementById('prediction-text');
                    const confidenceText = document.getElementById('confidence-text');

                    predictionText.innerText = "Processing...";
                    confidenceText.innerText = "Processing...";
                    
                    document.querySelector('.prediction').style.display = 'block';

                    // Sending image to the server
                    const formData = new FormData();
                    formData.append('file', file);

                    fetch('/predict', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                            document.getElementById('prediction-text').innerText = data.prediction;
                            document.getElementById('confidence-text').innerText = `${(data.confidence * 100).toFixed(2)}%`;
                        })

                        // Handling errors
                        .catch(error => {
                            console.error('Error:', error);
                            predictionText.innerText = "Error in prediction.";
                        });
                };

                // Reading file as data URL
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>

</html>
